import{jsx as e}from"react/jsx-runtime";import{useRef as t,useState as r,useMemo as n,useCallback as o,useEffect as i,forwardRef as a,useImperativeHandle as l}from"react";function s(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function l(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,l)}s((n=n.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const d={drawingEnabled:!1,isGrayscale:!1,cursor:"crosshair",copyImageToClipBoard:!0,imageQuality:"high",rect:{outterbackgroundColor:"rgba(0, 0, 0, 0.1)",borderWidth:1,borderColor:"#F14236",borderStyle:"dashed"},helperText:{show:!0,backgroundColor:"#F14236",textColor:"#fff",position:"bottom-right",fontSize:10,padding:2},dpr:1},c={low:.1,medium:.5,high:1},u=(e,a,l=d)=>{const u=null!=e?e:t(null),[h,g]=r(null),[p,v]=r(!1),f=n((()=>({width:0,height:0,x:0,y:0})),[]),[b,y]=r(f),m=n((()=>Object.assign(Object.assign({},d),l)),[l]),w=o((()=>{if(!h)return;const e=h.getContext("2d");null==e||e.clearRect(0,0,h.width,h.height),y(f)}),[h]);i((()=>{var e,t;const r=u.current;if(r){if(y(f),[...(null===(e=r.parentElement)||void 0===e?void 0:e.children)||[]].forEach((e=>{var t;"CANVAS"===e.tagName&&e.classList.contains("drawer-layer")&&(null===(t=r.parentElement)||void 0===t||t.removeChild(e))})),!m.drawingEnabled)return;const n=r.cloneNode(!0);n.className="drawer-layer",n.removeAttribute("style"),n.style.position="absolute",n.style.cursor=m.cursor||"crosshair",n.style.inset="0",n.style.zIndex="10",n.style.background="transparent";const o=n.getContext("2d");o&&(o.clearRect(0,0,n.width,n.height),o.fillStyle=(null===(t=m.rect)||void 0===t?void 0:t.outterbackgroundColor)||"rgba(0, 0, 0, 0.1)",o.fillRect(0,0,n.width,n.height)),g(n),r.after(n)}}),[u,m.drawingEnabled,m.scale,f]);const x=o((()=>{if(!b||!u.current)return null;const{x:e,y:t,width:r,height:n}=b,o=document.createElement("canvas");o.width=Math.abs(r),o.height=Math.abs(n);const i=o.getContext("2d");if(i){const{backgroundColor:a,background:l}=u.current.style;(a||l)&&(i.fillStyle=a||l||"#ffffff",i.fillRect(0,0,o.width,o.height)),m.isGrayscale&&(i.filter="grayscale(100%)"),null==i||i.drawImage(u.current,e,t,Math.abs(r),Math.abs(n),0,0,Math.abs(r),Math.abs(n)),m.isGrayscale&&(i.filter="none")}return o.toDataURL("image/png",c[m.imageQuality])}),[b,u,m.isGrayscale]);return i((()=>{if(!h)return;const e=h.getContext("2d");if(!e)return;if(!m.drawingEnabled)return void e.clearRect(0,0,h.width,h.height);const t=e=>{const t=h.getBoundingClientRect(),r=h.width/t.width/(m.dpr||1),n=h.height/t.height/(m.dpr||1),o=(e.clientX-t.left)*r,i=(e.clientY-t.top)*n;y((e=>Object.assign(Object.assign({},e),{x:o,y:i}))),v(!0)},r=t=>{var r,n,o,i,a,l,s,d,c,u,g,v,f;if(!p)return;const w=h.getBoundingClientRect(),x=h.width/w.width/(m.dpr||1),C=h.height/w.height/(m.dpr||1),E=(t.clientX-w.left)*x,O=(t.clientY-w.top)*C,k=E-b.x,S=O-b.y;y((e=>Object.assign(Object.assign({},e),{width:k,height:S}))),e.clearRect(0,0,h.width,h.height),e.fillStyle=(null===(r=m.rect)||void 0===r?void 0:r.outterbackgroundColor)||"rgba(0, 0, 0, 0.1)",e.fillRect(0,0,h.width,h.height);const T=null===(n=m.rect)||void 0===n?void 0:n.borderWidth;if(e.clearRect(b.x,b.y,k,S),"dashed"===(null===(o=m.rect)||void 0===o?void 0:o.borderStyle)?e.setLineDash([2*T,T]):"dotted"===(null===(i=m.rect)||void 0===i?void 0:i.borderStyle)?e.setLineDash([T,T]):e.setLineDash([]),e.strokeStyle=null===(a=m.rect)||void 0===a?void 0:a.borderColor,e.lineWidth=T,e.strokeRect(b.x-T/2,b.y-T/2,k+T,S+T),!m.helperText||m.helperText.show){const t=(null===(l=m.helperText)||void 0===l?void 0:l.value)||"Press Enter to submit, Escape to cancel";e.font=`${(null===(s=m.helperText)||void 0===s?void 0:s.fontSize)||16}px ${(null===(d=m.helperText)||void 0===d?void 0:d.fontFamily)||"Arial"}`,e.textBaseline="bottom",e.textAlign="right";const r=e.measureText(t),n=(null===(c=m.helperText)||void 0===c?void 0:c.padding)||8,o=r.width,i=(null===(u=m.helperText)||void 0===u?void 0:u.fontSize)||16,a=2*i+n;e.fillStyle=(null===(g=m.helperText)||void 0===g?void 0:g.backgroundColor)||"rgba(36, 172, 71, 0.9)";const h=(null===(v=m.helperText)||void 0===v?void 0:v.position)||"bottom-right";let p=0,y=0,w=0,x=0;const[C,E]=h.split("-");switch(C){case"top":y=b.y-a,p=b.y-i;break;case"bottom":y=b.y+S-i-2*n+a,p=b.y+S+a-n}switch(E){case"left":x=b.x,w=b.x+o+n;break;case"right":x=b.x+k-o-2*n,w=b.x+k-n;break;default:x=b.x+(k-o)/2-2*n,w=b.x+(k+o)/2-n}e.fillRect(x,y,o+2*n,i+2*n),e.fillStyle=(null===(f=m.helperText)||void 0===f?void 0:f.textColor)||"white",e.fillText(t,w,p),e.setLineDash([])}},n=()=>{v(!1)},o=e=>s(void 0,void 0,void 0,(function*(){if(e.preventDefault(),"Enter"===e.key){if(0===b.height||0===b.width)return;const e={isCanceled:!1,capturedImage:x(),rectCoords:b};null==a||a(e),m.copyImageToClipBoard&&(yield((e,...t)=>s(void 0,[e,...t],void 0,(function*(e,t="image/png"){try{const r=e.replace(/^data:.+;base64,/,""),n=atob(r),o=new Array(n.length);for(let e=0;e<n.length;e++)o[e]=n.charCodeAt(e);const i=new Uint8Array(o),a=new Blob([i],{type:t}),l=new ClipboardItem({[t]:a});yield navigator.clipboard.write([l]),console.log("Base64 image copied to clipboard!")}catch(e){console.error("Failed to copy Base64 image to clipboard:",e)}})))(e.capturedImage)),v(!1)}if("Escape"===e.key){w();null==a||a({isCanceled:!0,capturedImage:null,rectCoords:null})}}));return h.addEventListener("mousedown",t),h.addEventListener("mousemove",r),h.addEventListener("mouseup",n),document.body.addEventListener("keydown",o,{passive:!1}),()=>{h.removeEventListener("mousedown",t),h.removeEventListener("mousemove",r),h.removeEventListener("mouseup",n),document.body.removeEventListener("keydown",o)}}),[h,p,b,m,x,a,w]),{canvasRef:u}},h=a(((r,o)=>{var{drawingEnabled:i=!1,containerDivClassName:a="",onImageCaptured:s,onCaptureCanceled:d,option:c}=r,h=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}(r,["drawingEnabled","containerDivClassName","onImageCaptured","onCaptureCanceled","option"]);const g=t(null),p=n((()=>!!i),[i]);return l(o,(()=>g.current)),u(g,(e=>{const{isCanceled:t,capturedImage:r,rectCoords:n}=e;if(r&&n){const e=r,{width:t,height:o}=n;null==s||s({src:e,width:t,height:o})}t&&(null==d||d())}),Object.assign(Object.assign({},c),{drawingEnabled:p})),e("div",{style:{position:"relative"},className:a,children:e("canvas",Object.assign({className:"react-canvas-snap_canvas",ref:g},h))})}));h.displayName="Canvas";export{h as Canvas,u as useCanvasSnap};
//# sourceMappingURL=index.es.js.map
