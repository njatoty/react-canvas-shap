import{jsx as e}from"react/jsx-runtime";import{useRef as t,useState as n,useMemo as o,useCallback as r,useEffect as i,forwardRef as a,useImperativeHandle as l}from"react";function s(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function l(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const c={drawingEnabled:!1,isGrayscale:!1,cursor:"crosshair",copyImageToClipBoard:!0,imageQuality:"high",rect:{outterBackgroundColor:"rgba(0, 0, 0, 0.1)",borderWidth:1,borderColor:"#F14236",borderStyle:"dashed"},helperText:{show:!0,backgroundColor:"#F14236",textColor:"#fff",position:"bottom-right",fontSize:10,padding:2}},d={low:.1,medium:.5,high:1},u=(e,a,l=c)=>{const u=null!=e?e:t(null),[h,g]=n(null),[v,p]=n(!1),f=o((()=>({width:0,height:0,x:0,y:0})),[]),[y,b]=n(f),m=o((()=>Object.assign(Object.assign({},c),l)),[l]),w=r((()=>{if(!h)return;const e=h.getContext("2d");null==e||e.clearRect(0,0,h.width,h.height),b(f)}),[h]);i((()=>{var e,t;const n=u.current;if(n){if(b(f),[...(null===(e=n.parentElement)||void 0===e?void 0:e.children)||[]].forEach((e=>{var t;"CANVAS"===e.tagName&&e.classList.contains("drawer-layer")&&(null===(t=n.parentElement)||void 0===t||t.removeChild(e))})),!m.drawingEnabled)return;const o=n.cloneNode(!0);o.className="drawer-layer",o.removeAttribute("style"),o.style.position="absolute",o.style.cursor=m.cursor||"crosshair",o.style.inset="0",o.style.zIndex="10",o.style.background="transparent";const r=o.getContext("2d");r&&(r.clearRect(0,0,o.width,o.height),r.fillStyle=(null===(t=m.rect)||void 0===t?void 0:t.outterBackgroundColor)||"rgba(0, 0, 0, 0.1)",r.fillRect(0,0,o.width,o.height)),g(o),n.after(o)}}),[u,m.drawingEnabled,f]);const x=r((()=>{if(!y||!u.current)return null;const{x:e,y:t,width:n,height:o}=y,r=document.createElement("canvas");r.width=Math.abs(n),r.height=Math.abs(o);const i=r.getContext("2d");if(i){const{backgroundColor:a,background:l}=u.current.style;i.fillStyle=a||l||"#ffffff",i.fillRect(0,0,r.width,r.height),m.isGrayscale&&(i.filter="grayscale(100%)"),null==i||i.drawImage(u.current,e,t,Math.abs(n),Math.abs(o),0,0,Math.abs(n),Math.abs(o)),m.isGrayscale&&(i.filter="none")}return r.toDataURL("image/png",d[m.imageQuality])}),[y,u,m.isGrayscale]);return i((()=>{if(!h)return;const e=h.getContext("2d");if(!e)return;if(!m.drawingEnabled)return void e.clearRect(0,0,h.width,h.height);const t=e=>{const t=h.getBoundingClientRect(),n=h.width/t.width,o=h.height/t.height,r=(e.clientX-t.left)*n,i=(e.clientY-t.top)*o;b((e=>Object.assign(Object.assign({},e),{x:r,y:i}))),p(!0)},n=t=>{var n,o,r,i,a,l,s,c,d,u,g,p,f,w;if(!v)return;const x=h.getBoundingClientRect(),C=h.width/x.width,E=h.height/x.height,O=(t.clientX-x.left)*C,k=(t.clientY-x.top)*E,S=O-y.x,T=k-y.y;b((e=>Object.assign(Object.assign({},e),{width:S,height:T}))),e.clearRect(0,0,h.width,h.height),e.fillStyle=(null===(n=m.rect)||void 0===n?void 0:n.outterBackgroundColor)||"rgba(0, 0, 0, 0.1)",e.fillRect(0,0,h.width,h.height);const j=null===(o=m.rect)||void 0===o?void 0:o.borderWidth;if(e.clearRect(y.x,y.y,S,T),"dashed"===(null===(r=m.rect)||void 0===r?void 0:r.borderStyle)?e.setLineDash([2*j,j]):"dotted"===(null===(i=m.rect)||void 0===i?void 0:i.borderStyle)?e.setLineDash([j,j]):e.setLineDash([]),e.strokeStyle=null===(a=m.rect)||void 0===a?void 0:a.borderColor,e.lineWidth=j,e.strokeRect(y.x-j/2,y.y-j/2,S+j,T+j),!m.helperText||m.helperText.show){if(!(null===(l=m.helperText)||void 0===l?void 0:l.show))return;const t=(null===(s=m.helperText)||void 0===s?void 0:s.value)||"Press Enter to submit, Escape to cancel";e.font=`${(null===(c=m.helperText)||void 0===c?void 0:c.fontSize)||16}px ${(null===(d=m.helperText)||void 0===d?void 0:d.fontFamily)||"Arial"}`,e.textBaseline="bottom",e.textAlign="right";const n=e.measureText(t),o=(null===(u=m.helperText)||void 0===u?void 0:u.padding)||8,r=n.width,i=(null===(g=m.helperText)||void 0===g?void 0:g.fontSize)||16,a=2*i+o;e.fillStyle=(null===(p=m.helperText)||void 0===p?void 0:p.backgroundColor)||"rgba(36, 172, 71, 0.9)";const h=(null===(f=m.helperText)||void 0===f?void 0:f.position)||"bottom-right";let v=0,b=0,x=0,C=0;const[E,O]=h.split("-");switch(E){case"top":b=y.y-a,v=y.y-i;break;case"bottom":b=y.y+T-i-2*o+a,v=y.y+T+a-o}switch(O){case"left":C=y.x,x=y.x+r+o;break;case"right":C=y.x+S-r-2*o,x=y.x+S-o;break;default:C=y.x+(S-r)/2-2*o,x=y.x+(S+r)/2-o}e.fillRect(C,b,r+2*o,i+2*o),e.fillStyle=(null===(w=m.helperText)||void 0===w?void 0:w.textColor)||"white",e.fillText(t,x,v),e.setLineDash([])}},o=()=>{p(!1)},r=e=>s(void 0,void 0,void 0,(function*(){if(e.preventDefault(),"Enter"===e.key){if(0===y.height||0===y.width)return;const e={isCanceled:!1,capturedImage:x(),rectCoords:y};null==a||a(e),m.copyImageToClipBoard&&(yield((e,t="image/png")=>s(void 0,void 0,void 0,(function*(){try{const n=e.replace(/^data:.+;base64,/,""),o=atob(n),r=new Array(o.length);for(let e=0;e<o.length;e++)r[e]=o.charCodeAt(e);const i=new Uint8Array(r),a=new Blob([i],{type:t}),l=new ClipboardItem({[t]:a});yield navigator.clipboard.write([l]),console.log("Base64 image copied to clipboard!")}catch(e){console.error("Failed to copy Base64 image to clipboard:",e)}})))(e.capturedImage)),p(!1)}if("Escape"===e.key){w();null==a||a({isCanceled:!0,capturedImage:null,rectCoords:null})}}));return h.addEventListener("mousedown",t),h.addEventListener("mousemove",n),h.addEventListener("mouseup",o),document.body.addEventListener("keydown",r,{passive:!1}),()=>{h.removeEventListener("mousedown",t),h.removeEventListener("mousemove",n),h.removeEventListener("mouseup",o),document.body.removeEventListener("keydown",r)}}),[h,v,y,m,x,a,w]),{canvasRef:u}},h=a(((n,r)=>{var{drawingEnabled:i=!1,containerDivClassName:a="",onImageCaptured:s,onCaptureCanceled:c,option:d}=n,h=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]])}return n}(n,["drawingEnabled","containerDivClassName","onImageCaptured","onCaptureCanceled","option"]);const g=t(null),v=o((()=>!!i),[i]);return l(r,(()=>g.current)),u(g,(e=>{const{isCanceled:t,capturedImage:n,rectCoords:o}=e;if(n&&o){const e=n,{width:t,height:r}=o;null==s||s({src:e,width:t,height:r,coordinates:o})}t&&(null==c||c())}),Object.assign(Object.assign({},d),{drawingEnabled:v})),e("div",Object.assign({style:{position:"relative"},className:a},{children:e("canvas",Object.assign({className:"react-canvas-snap_canvas",ref:g},h))}))}));h.displayName="Canvas";export{h as Canvas,u as useCanvasSnap};
//# sourceMappingURL=index.es.js.map
