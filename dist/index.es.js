import{jsx as e}from"react/jsx-runtime";import{useRef as t,useState as o,useMemo as r,useCallback as n,useEffect as i,forwardRef as l,useImperativeHandle as a}from"react";function d(e,t,o,r){return new(o||(o=Promise))((function(n,i){function l(e){try{d(r.next(e))}catch(e){i(e)}}function a(e){try{d(r.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}d((r=r.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const s=(e,t)=>{for(const o in t)if(t.hasOwnProperty(o)){const r=o;t[r]&&"object"==typeof t[r]&&!Array.isArray(t[r])?e[r]=s(e[r],t[r]):e[r]=t[r]}return e},c={drawingEnabled:!1,isGrayscale:!1,cursor:"crosshair",copyImageToClipBoard:!0,imageQuality:"high",rect:{outterBackgroundColor:"rgba(0, 0, 0, 0.1)",borderWidth:1,borderColor:"#F14236",borderStyle:"dashed"},helperText:{show:!0,backgroundColor:"#F14236",textColor:"#ffffff",position:"auto",fontSize:10,fontFamily:"Arial",padding:2,value:"Press Enter to capture, Escape to cancel",textHeight:10}},h={low:.1,medium:.5,high:1},u=(e,l,a=c)=>{const u=null!=e?e:t(null),[g,p]=o(null),[f,v]=o(!1),y=r((()=>({width:0,height:0,x:0,y:0})),[]),[m,b]=o(y),w=r((()=>s(c,a)),[a]),x=n((()=>{if(!g)return;const e=g.getContext("2d");null==e||e.clearRect(0,0,g.width,g.height),b(y)}),[g]);i((()=>{var e,t;const o=u.current;if(o){if(b(y),[...(null===(e=o.parentElement)||void 0===e?void 0:e.children)||[]].forEach((e=>{var t;"CANVAS"===e.tagName&&e.classList.contains("drawer-layer")&&(null===(t=o.parentElement)||void 0===t||t.removeChild(e))})),!w.drawingEnabled)return;const r=o.cloneNode(!0);r.className="drawer-layer",r.removeAttribute("style"),r.style.position="absolute",r.style.cursor=w.cursor,r.style.inset="0",r.style.zIndex="10",r.style.background="transparent";const n=r.getContext("2d");n&&(n.clearRect(0,0,r.width,r.height),n.fillStyle=null===(t=w.rect)||void 0===t?void 0:t.outterBackgroundColor,n.fillRect(0,0,r.width,r.height)),p(r),o.after(r)}}),[u,w.drawingEnabled,y]);const C=n((()=>{if(!m||!u.current)return null;const{x:e,y:t,width:o,height:r}=(e=>{let{x:t,y:o,width:r,height:n}=e;return r<0&&(t+=r,r=-r),n<0&&(o+=n,n=-n),{x:t,y:o,width:r,height:n}})(m),n=document.createElement("canvas");n.width=Math.abs(o),n.height=Math.abs(r);const i=n.getContext("2d");if(i){const{backgroundColor:l,background:a}=u.current.style;i.fillStyle=l||a||"#ffffff",i.fillRect(0,0,n.width,n.height),w.isGrayscale&&(i.filter="grayscale(100%)"),null==i||i.drawImage(u.current,e,t,Math.abs(o),Math.abs(r),0,0,Math.abs(o),Math.abs(r)),w.isGrayscale&&(i.filter="none")}return n.toDataURL("image/png",h[w.imageQuality])}),[m,u,w.isGrayscale]);return i((()=>{if(!g)return;const e=g.getContext("2d");if(!e)return;if(!w.drawingEnabled)return void e.clearRect(0,0,g.width,g.height);const t=e=>{const t=g.getBoundingClientRect(),o=g.width/t.width,r=g.height/t.height,n=(e.clientX-t.left)*o,i=(e.clientY-t.top)*r;b((e=>Object.assign(Object.assign({},e),{x:n,y:i}))),v(!0)},o=t=>{var o,r,n,i,l,a,d,s,c,h,u,p,v,y;if(!f)return;const x=g.getBoundingClientRect(),{x:C,y:E}=m,O=g.width/x.width,k=g.height/x.height,S=(t.clientX-x.left)*O,T=(t.clientY-x.top)*k,j=S-C,L=T-E;b((e=>Object.assign(Object.assign({},e),{width:j,height:L}))),e.clearRect(0,0,g.width,g.height),e.fillStyle=null===(o=w.rect)||void 0===o?void 0:o.outterBackgroundColor,e.fillRect(0,0,g.width,g.height);const R=null===(r=w.rect)||void 0===r?void 0:r.borderWidth;if(e.clearRect(C,E,j,L),"dashed"===(null===(n=w.rect)||void 0===n?void 0:n.borderStyle)?e.setLineDash([2*R,R]):"dotted"===(null===(i=w.rect)||void 0===i?void 0:i.borderStyle)?e.setLineDash([R,R]):e.setLineDash([]),e.strokeStyle=null===(l=w.rect)||void 0===l?void 0:l.borderColor,e.lineWidth=R,e.strokeRect(C-R/2,E-R/2,j+R,L+R),!w.helperText||w.helperText.show){if(!(null===(a=w.helperText)||void 0===a?void 0:a.show))return;const t=null===(d=w.helperText)||void 0===d?void 0:d.value;e.font=`${null===(s=w.helperText)||void 0===s?void 0:s.fontSize}px ${null===(c=w.helperText)||void 0===c?void 0:c.fontFamily}`,e.textBaseline="bottom",e.textAlign="right";const o=e.measureText(t),r=null===(h=w.helperText)||void 0===h?void 0:h.padding,n=o.width,i=null===(u=w.helperText)||void 0===u?void 0:u.fontSize,l=2*i+r;e.fillStyle=null===(p=w.helperText)||void 0===p?void 0:p.backgroundColor;let g=null===(v=w.helperText)||void 0===v?void 0:v.position;if("auto"===g){let e="top",t="right";E<l&&(e="bottom"),E+L>=x.height-l&&(e="top"),L<0&&(e="top",L+E<=l&&(e="bottom")),n<=x.width&&j>0?(t="left",C+n>=x.width&&(t="right")):(t="right",C+j<n&&(t="left")),g=`${e}-${t}`}let f=0,m=0,b=0,O=0;const[k,S]=g.split("-");switch(k){case"top":L<0?(m=E-l+L,f=E-i+L):(m=E-l,f=E-i);break;case"bottom":L<0?(m=E-i-2*r+l,f=E+l-r):(m=E+L-i-2*r+l,f=E+L+l-r)}switch(S){case"left":j<0?(O=C+j,b=C+j+n+r):(O=C,b=C+n+r);break;case"right":j<0?(O=C-n-2*r,b=C-r):(O=C+j-n-2*r,b=C+j-r);break;default:O=C+(j-n)/2-2*r,b=C+(j+n)/2-r}e.fillRect(O,m,n+2*r,i+2*r),e.fillStyle=null===(y=w.helperText)||void 0===y?void 0:y.textColor,e.fillText(t,b,f),e.setLineDash([])}},r=()=>{v(!1)},n=e=>d(void 0,void 0,void 0,(function*(){if(e.preventDefault(),"Enter"===e.key){if(0===m.height||0===m.width)return;const e={isCanceled:!1,capturedImage:C(),rectCoords:m};null==l||l(e),w.copyImageToClipBoard&&(yield((e,t="image/png")=>d(void 0,void 0,void 0,(function*(){try{const o=e.replace(/^data:.+;base64,/,""),r=atob(o),n=new Array(r.length);for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);const i=new Uint8Array(n),l=new Blob([i],{type:t}),a=new ClipboardItem({[t]:l});yield navigator.clipboard.write([a]),console.log("Base64 image copied to clipboard!")}catch(e){console.error("Failed to copy Base64 image to clipboard:",e)}})))(e.capturedImage)),v(!1)}if("Escape"===e.key){x();null==l||l({isCanceled:!0,capturedImage:null,rectCoords:null})}}));return g.addEventListener("mousedown",t),g.addEventListener("mousemove",o),g.addEventListener("mouseup",r),document.body.addEventListener("keydown",n,{passive:!1}),()=>{g.removeEventListener("mousedown",t),g.removeEventListener("mousemove",o),g.removeEventListener("mouseup",r),document.body.removeEventListener("keydown",n)}}),[g,f,m,w,C,l,x]),{canvasRef:u}},g=l(((o,n)=>{var{drawingEnabled:i=!1,containerDivClassName:l="",onImageCaptured:d,onCaptureCanceled:s,option:c}=o,h=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(o[r[n]]=e[r[n]])}return o}(o,["drawingEnabled","containerDivClassName","onImageCaptured","onCaptureCanceled","option"]);const g=t(null),p=r((()=>!!i),[i]);return a(n,(()=>g.current)),u(g,(e=>{const{isCanceled:t,capturedImage:o,rectCoords:r}=e;if(o&&r){const e=o,{width:t,height:n}=r;null==d||d({src:e,width:t,height:n,coordinates:r})}t&&(null==s||s())}),Object.assign(Object.assign({},c),{drawingEnabled:p})),e("div",Object.assign({style:{position:"relative"},className:l},{children:e("canvas",Object.assign({className:"react-canvas-snap_canvas",ref:g},h))}))}));g.displayName="Canvas";export{g as Canvas,u as useCanvasSnap};
//# sourceMappingURL=index.es.js.map
