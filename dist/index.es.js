import{jsx as e}from"react/jsx-runtime";import{useRef as t,useState as n,useMemo as r,useEffect as i,useCallback as o,forwardRef as l,useImperativeHandle as a}from"react";"function"==typeof SuppressedError&&SuppressedError;const s=(e,t)=>{if(e===t)return!0;if(null===e||null===t||"object"!=typeof e||"object"!=typeof t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const i of n)if(!r.includes(i)||!s(e[i],t[i]))return!1;return!0},d=(e,l,a={drawingEnabled:!1,isGrayscale:!1})=>{const d=null!=e?e:t(null),[c,u]=n(null),[h,v]=n(!1),p=r((()=>({width:0,height:0,x:0,y:0})),[]),[g,f]=n(p),[y,b]=n(a);i((()=>{s(a,y)||b(a)}),[a,y]);const m=o((()=>{if(!c)return;const e=c.getContext("2d");null==e||e.clearRect(0,0,c.width,c.height),f(p)}),[c]);i((()=>{var e;const t=d.current;if(t){if(f(p),[...(null===(e=t.parentElement)||void 0===e?void 0:e.children)||[]].forEach((e=>{var n;"CANVAS"===e.tagName&&e.classList.contains("drawer-layer")&&(null===(n=t.parentElement)||void 0===n||n.removeChild(e))})),!y.drawingEnabled)return;const n=t.cloneNode(!0);n.className="drawer-layer",n.style.position="absolute",n.style.cursor="crosshair",n.style.inset="0",n.style.zIndex="10",u(n),t.after(n)}}),[d,y.drawingEnabled,y.scale,p]);const x=o((()=>{if(!g||!d.current)return null;const{x:e,y:t,width:n,height:r}=g,i=document.createElement("canvas");i.width=Math.abs(n),i.height=Math.abs(r);const o=i.getContext("2d");return o&&(y.isGrayscale&&(o.filter="grayscale(100%)"),null==o||o.drawImage(d.current,e,t,Math.abs(n),Math.abs(r),0,0,Math.abs(n),Math.abs(r)),y.isGrayscale&&(o.filter="none")),i.toDataURL("image/png")}),[g,d,y.isGrayscale]);return i((()=>{if(!c)return;const e=c.getContext("2d");if(!e)return;if(!y.drawingEnabled)return void e.clearRect(0,0,c.width,c.height);const t=e=>{const t=c.getBoundingClientRect(),n=c.width/t.width/(y.dpr||1),r=c.height/t.height/(y.dpr||1),i=(e.clientX-t.left)*n,o=(e.clientY-t.top)*r;f((e=>Object.assign(Object.assign({},e),{x:i,y:o}))),v(!0)},n=t=>{var n,r,i,o,l,a,s,d,u,v,p,b,m;if(!h)return;const x=c.getBoundingClientRect(),w=c.width/x.width/(y.dpr||1),E=c.height/x.height/(y.dpr||1),C=(t.clientX-x.left)*w,O=(t.clientY-x.top)*E,j=C-g.x,L=O-g.y;f((e=>Object.assign(Object.assign({},e),{width:j,height:L}))),e.clearRect(0,0,c.width,c.height),e.fillStyle=(null===(n=y.rect)||void 0===n?void 0:n.outterbackgroundColor)||"rgba(0, 0, 0, 0.2)",e.fillRect(0,0,c.width,c.height);const k=(null===(r=y.rect)||void 0===r?void 0:r.borderWidth)||4;if(e.clearRect(g.x,g.y,j,L),"dashed"===(null===(i=y.rect)||void 0===i?void 0:i.borderStyle)?e.setLineDash([2*k,k]):"dotted"===(null===(o=y.rect)||void 0===o?void 0:o.borderStyle)?e.setLineDash([k,k]):e.setLineDash([]),e.strokeStyle=(null===(l=y.rect)||void 0===l?void 0:l.borderColor)||"green",e.lineWidth=k,e.strokeRect(g.x-k/2,g.y-k/2,j+k,L+k),!y.helperText||y.helperText.show){const t=(null===(a=y.helperText)||void 0===a?void 0:a.value)||"Press Enter to submit, Escape to cancel";e.font=`${(null===(s=y.helperText)||void 0===s?void 0:s.fontSize)||16}px ${(null===(d=y.helperText)||void 0===d?void 0:d.fontFamily)||"Arial"}`,e.textBaseline="bottom",e.textAlign="right";const n=e.measureText(t),r=(null===(u=y.helperText)||void 0===u?void 0:u.padding)||8,i=n.width,o=(null===(v=y.helperText)||void 0===v?void 0:v.fontSize)||16,l=2*o+r;e.fillStyle=(null===(p=y.helperText)||void 0===p?void 0:p.backgroundColor)||"rgba(36, 172, 71, 0.9)";const c=(null===(b=y.helperText)||void 0===b?void 0:b.position)||"bottom-right";let h=0,f=0,x=0,w=0;const[E,C]=c.split("-");switch(E){case"top":f=g.y-l,h=g.y-o;break;case"bottom":f=g.y+L-o-2*r+l,h=g.y+L+l-r}switch(C){case"left":w=g.x,x=g.x+i+r;break;case"right":w=g.x+j-i-2*r,x=g.x+j-r;break;default:w=g.x+(j-i)/2-2*r,x=g.x+(j+i)/2-r}e.fillRect(w,f,i+2*r,o+2*r),e.fillStyle=(null===(m=y.helperText)||void 0===m?void 0:m.textColor)||"white",e.fillText(t,x,h),e.setLineDash([])}},r=()=>{v(!1)},i=e=>{if(e.preventDefault(),0!==g.height&&0!==g.width){if("Enter"===e.key){const e={isCanceled:!1,capturedImage:x(),rectCoords:g};l&&l(e),v(!1)}"Escape"===e.key&&m()}};return c.addEventListener("mousedown",t),c.addEventListener("mousemove",n),c.addEventListener("mouseup",r),document.body.addEventListener("keydown",i,{passive:!1}),()=>{c.removeEventListener("mousedown",t),c.removeEventListener("mousemove",n),c.removeEventListener("mouseup",r),document.body.removeEventListener("keydown",i)}}),[c,h,g,y,x,l,m]),{canvasRef:d}},c=l(((n,r)=>{var{drawingEnabled:i=!1,containerDivClassName:o="",onCaptured:l,onCanceled:s}=n,c=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(n,["drawingEnabled","containerDivClassName","onCaptured","onCanceled"]);const u=t(null);return a(r,(()=>u.current)),d(u,(e=>{const t=e.capturedImage;null==l||l(t),e.isCanceled&&(null==s||s())}),Object.assign(Object.assign({},c.option),{drawingEnabled:i})),e("div",{style:{position:"relative"},className:o,children:e("canvas",Object.assign({ref:u},c))})}));c.displayName="Canvas";export{c as Canvas,d as useCanvasSnap};
//# sourceMappingURL=index.es.js.map
