"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react/jsx-runtime"),t=require("react");function r(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function l(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const o=(e,t)=>{for(const r in t)if(t.hasOwnProperty(r)){const n=r;t[n]&&"object"==typeof t[n]&&!Array.isArray(t[n])?e[n]=o(e[n],t[n]):e[n]=t[n]}return e},n={drawingEnabled:!1,isGrayscale:!1,cursor:"crosshair",copyImageToClipBoard:!0,imageQuality:"high",rect:{outterBackgroundColor:"rgba(0, 0, 0, 0.1)",borderWidth:1,borderColor:"#F14236",borderStyle:"dashed"},helperText:{show:!0,backgroundColor:"#F14236",textColor:"#fff",position:"bottom-right",fontSize:10,padding:2}},i={low:.1,medium:.5,high:1},a=(e,a,l=n)=>{const s=null!=e?e:t.useRef(null),[c,d]=t.useState(null),[u,h]=t.useState(!1),g=t.useMemo((()=>({width:0,height:0,x:0,y:0})),[]),[v,p]=t.useState(g),f=t.useMemo((()=>o(n,l)),[l]),y=t.useCallback((()=>{if(!c)return;const e=c.getContext("2d");null==e||e.clearRect(0,0,c.width,c.height),p(g)}),[c]);t.useEffect((()=>{var e,t;const r=s.current;if(r){if(p(g),[...(null===(e=r.parentElement)||void 0===e?void 0:e.children)||[]].forEach((e=>{var t;"CANVAS"===e.tagName&&e.classList.contains("drawer-layer")&&(null===(t=r.parentElement)||void 0===t||t.removeChild(e))})),!f.drawingEnabled)return;const o=r.cloneNode(!0);o.className="drawer-layer",o.removeAttribute("style"),o.style.position="absolute",o.style.cursor=f.cursor||"crosshair",o.style.inset="0",o.style.zIndex="10",o.style.background="transparent";const n=o.getContext("2d");n&&(n.clearRect(0,0,o.width,o.height),n.fillStyle=(null===(t=f.rect)||void 0===t?void 0:t.outterBackgroundColor)||"rgba(0, 0, 0, 0.1)",n.fillRect(0,0,o.width,o.height)),d(o),r.after(o)}}),[s,f.drawingEnabled,g]);const b=t.useCallback((()=>{if(!v||!s.current)return null;const{x:e,y:t,width:r,height:o}=v,n=document.createElement("canvas");n.width=Math.abs(r),n.height=Math.abs(o);const a=n.getContext("2d");if(a){const{backgroundColor:i,background:l}=s.current.style;a.fillStyle=i||l||"#ffffff",a.fillRect(0,0,n.width,n.height),f.isGrayscale&&(a.filter="grayscale(100%)"),null==a||a.drawImage(s.current,e,t,Math.abs(r),Math.abs(o),0,0,Math.abs(r),Math.abs(o)),f.isGrayscale&&(a.filter="none")}return n.toDataURL("image/png",i[f.imageQuality])}),[v,s,f.isGrayscale]);return t.useEffect((()=>{if(!c)return;const e=c.getContext("2d");if(!e)return;if(!f.drawingEnabled)return void e.clearRect(0,0,c.width,c.height);const t=e=>{const t=c.getBoundingClientRect(),r=c.width/t.width,o=c.height/t.height,n=(e.clientX-t.left)*r,i=(e.clientY-t.top)*o;p((e=>Object.assign(Object.assign({},e),{x:n,y:i}))),h(!0)},o=t=>{var r,o,n,i,a,l,s,d,h,g,y,b,m,w;if(!u)return;const x=c.getBoundingClientRect(),C=c.width/x.width,E=c.height/x.height,S=(t.clientX-x.left)*C,k=(t.clientY-x.top)*E,O=S-v.x,j=k-v.y;p((e=>Object.assign(Object.assign({},e),{width:O,height:j}))),e.clearRect(0,0,c.width,c.height),e.fillStyle=(null===(r=f.rect)||void 0===r?void 0:r.outterBackgroundColor)||"rgba(0, 0, 0, 0.1)",e.fillRect(0,0,c.width,c.height);const R=null===(o=f.rect)||void 0===o?void 0:o.borderWidth;if(e.clearRect(v.x,v.y,O,j),"dashed"===(null===(n=f.rect)||void 0===n?void 0:n.borderStyle)?e.setLineDash([2*R,R]):"dotted"===(null===(i=f.rect)||void 0===i?void 0:i.borderStyle)?e.setLineDash([R,R]):e.setLineDash([]),e.strokeStyle=null===(a=f.rect)||void 0===a?void 0:a.borderColor,e.lineWidth=R,e.strokeRect(v.x-R/2,v.y-R/2,O+R,j+R),!f.helperText||f.helperText.show){if(!(null===(l=f.helperText)||void 0===l?void 0:l.show))return;const t=(null===(s=f.helperText)||void 0===s?void 0:s.value)||"Press Enter to submit, Escape to cancel";e.font=`${(null===(d=f.helperText)||void 0===d?void 0:d.fontSize)||16}px ${(null===(h=f.helperText)||void 0===h?void 0:h.fontFamily)||"Arial"}`,e.textBaseline="bottom",e.textAlign="right";const r=e.measureText(t),o=(null===(g=f.helperText)||void 0===g?void 0:g.padding)||8,n=r.width,i=(null===(y=f.helperText)||void 0===y?void 0:y.fontSize)||16,a=2*i+o;e.fillStyle=(null===(b=f.helperText)||void 0===b?void 0:b.backgroundColor)||"rgba(36, 172, 71, 0.9)";const c=(null===(m=f.helperText)||void 0===m?void 0:m.position)||"bottom-right";let u=0,p=0,x=0,C=0;const[E,S]=c.split("-");switch(E){case"top":p=v.y-a,u=v.y-i;break;case"bottom":p=v.y+j-i-2*o+a,u=v.y+j+a-o}switch(S){case"left":C=v.x,x=v.x+n+o;break;case"right":C=v.x+O-n-2*o,x=v.x+O-o;break;default:C=v.x+(O-n)/2-2*o,x=v.x+(O+n)/2-o}e.fillRect(C,p,n+2*o,i+2*o),e.fillStyle=(null===(w=f.helperText)||void 0===w?void 0:w.textColor)||"white",e.fillText(t,x,u),e.setLineDash([])}},n=()=>{h(!1)},i=e=>r(void 0,void 0,void 0,(function*(){if(e.preventDefault(),"Enter"===e.key){if(0===v.height||0===v.width)return;const e={isCanceled:!1,capturedImage:b(),rectCoords:v};null==a||a(e),f.copyImageToClipBoard&&(yield((e,t="image/png")=>r(void 0,void 0,void 0,(function*(){try{const r=e.replace(/^data:.+;base64,/,""),o=atob(r),n=new Array(o.length);for(let e=0;e<o.length;e++)n[e]=o.charCodeAt(e);const i=new Uint8Array(n),a=new Blob([i],{type:t}),l=new ClipboardItem({[t]:a});yield navigator.clipboard.write([l]),console.log("Base64 image copied to clipboard!")}catch(e){console.error("Failed to copy Base64 image to clipboard:",e)}})))(e.capturedImage)),h(!1)}if("Escape"===e.key){y();null==a||a({isCanceled:!0,capturedImage:null,rectCoords:null})}}));return c.addEventListener("mousedown",t),c.addEventListener("mousemove",o),c.addEventListener("mouseup",n),document.body.addEventListener("keydown",i,{passive:!1}),()=>{c.removeEventListener("mousedown",t),c.removeEventListener("mousemove",o),c.removeEventListener("mouseup",n),document.body.removeEventListener("keydown",i)}}),[c,u,v,f,b,a,y]),{canvasRef:s}},l=t.forwardRef(((r,o)=>{var{drawingEnabled:n=!1,containerDivClassName:i="",onImageCaptured:l,onCaptureCanceled:s,option:c}=r,d=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]])}return r}(r,["drawingEnabled","containerDivClassName","onImageCaptured","onCaptureCanceled","option"]);const u=t.useRef(null),h=t.useMemo((()=>!!n),[n]);return t.useImperativeHandle(o,(()=>u.current)),a(u,(e=>{const{isCanceled:t,capturedImage:r,rectCoords:o}=e;if(r&&o){const e=r,{width:t,height:n}=o;null==l||l({src:e,width:t,height:n,coordinates:o})}t&&(null==s||s())}),Object.assign(Object.assign({},c),{drawingEnabled:h})),e.jsx("div",Object.assign({style:{position:"relative"},className:i},{children:e.jsx("canvas",Object.assign({className:"react-canvas-snap_canvas",ref:u},d))}))}));l.displayName="Canvas",exports.Canvas=l,exports.useCanvasSnap=a;
//# sourceMappingURL=index.js.map
