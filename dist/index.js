"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react/jsx-runtime"),t=require("react");"function"==typeof SuppressedError&&SuppressedError;const n=(e,t)=>{if(e===t)return!0;if(null===e||null===t||"object"!=typeof e||"object"!=typeof t)return!1;const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(const o of r)if(!i.includes(o)||!n(e[o],t[o]))return!1;return!0},r=(e,r,i={drawingEnabled:!1,isGrayscale:!1})=>{const o=null!=e?e:t.useRef(null),[l,s]=t.useState(null),[a,d]=t.useState(!1),c=t.useMemo((()=>({width:0,height:0,x:0,y:0})),[]),[u,h]=t.useState(c),[v,f]=t.useState(i);t.useEffect((()=>{n(i,v)||f(i)}),[i,v]);const p=t.useCallback((()=>{if(!l)return;const e=l.getContext("2d");null==e||e.clearRect(0,0,l.width,l.height),h(c)}),[l]);t.useEffect((()=>{var e;const t=o.current;if(t){if(h(c),[...(null===(e=t.parentElement)||void 0===e?void 0:e.children)||[]].forEach((e=>{var n;"CANVAS"===e.tagName&&e.classList.contains("drawer-layer")&&(null===(n=t.parentElement)||void 0===n||n.removeChild(e))})),!v.drawingEnabled)return;const n=t.cloneNode(!0);n.className="drawer-layer",n.style.position="absolute",n.style.cursor="crosshair",n.style.inset="0",n.style.zIndex="10",s(n),t.after(n)}}),[o,v.drawingEnabled,v.scale,c]);const g=t.useCallback((()=>{if(!u||!o.current)return null;const{x:e,y:t,width:n,height:r}=u,i=document.createElement("canvas");i.width=Math.abs(n),i.height=Math.abs(r);const l=i.getContext("2d");return l&&(v.isGrayscale&&(l.filter="grayscale(100%)"),null==l||l.drawImage(o.current,e,t,Math.abs(n),Math.abs(r),0,0,Math.abs(n),Math.abs(r)),v.isGrayscale&&(l.filter="none")),i.toDataURL("image/png")}),[u,o,v.isGrayscale]);return t.useEffect((()=>{if(!l)return;const e=l.getContext("2d");if(!e)return;if(!v.drawingEnabled)return void e.clearRect(0,0,l.width,l.height);const t=e=>{const t=l.getBoundingClientRect(),n=l.width/t.width/(v.dpr||1),r=l.height/t.height/(v.dpr||1),i=(e.clientX-t.left)*n,o=(e.clientY-t.top)*r;h((e=>Object.assign(Object.assign({},e),{x:i,y:o}))),d(!0)},n=t=>{var n,r,i,o,s,d,c,f,p,g,b,y,m;if(!a)return;const x=l.getBoundingClientRect(),w=l.width/x.width/(v.dpr||1),E=l.height/x.height/(v.dpr||1),C=(t.clientX-x.left)*w,j=(t.clientY-x.top)*E,O=C-u.x,S=j-u.y;h((e=>Object.assign(Object.assign({},e),{width:O,height:S}))),e.clearRect(0,0,l.width,l.height),e.fillStyle=(null===(n=v.rect)||void 0===n?void 0:n.outterbackgroundColor)||"rgba(0, 0, 0, 0.2)",e.fillRect(0,0,l.width,l.height);const k=(null===(r=v.rect)||void 0===r?void 0:r.borderWidth)||4;if(e.clearRect(u.x,u.y,O,S),"dashed"===(null===(i=v.rect)||void 0===i?void 0:i.borderStyle)?e.setLineDash([2*k,k]):"dotted"===(null===(o=v.rect)||void 0===o?void 0:o.borderStyle)?e.setLineDash([k,k]):e.setLineDash([]),e.strokeStyle=(null===(s=v.rect)||void 0===s?void 0:s.borderColor)||"green",e.lineWidth=k,e.strokeRect(u.x-k/2,u.y-k/2,O+k,S+k),!v.helperText||v.helperText.show){const t=(null===(d=v.helperText)||void 0===d?void 0:d.value)||"Press Enter to submit, Escape to cancel";e.font=`${(null===(c=v.helperText)||void 0===c?void 0:c.fontSize)||16}px ${(null===(f=v.helperText)||void 0===f?void 0:f.fontFamily)||"Arial"}`,e.textBaseline="bottom",e.textAlign="right";const n=e.measureText(t),r=(null===(p=v.helperText)||void 0===p?void 0:p.padding)||8,i=n.width,o=(null===(g=v.helperText)||void 0===g?void 0:g.fontSize)||16,l=2*o+r;e.fillStyle=(null===(b=v.helperText)||void 0===b?void 0:b.backgroundColor)||"rgba(36, 172, 71, 0.9)";const s=(null===(y=v.helperText)||void 0===y?void 0:y.position)||"bottom-right";let a=0,h=0,x=0,w=0;const[E,C]=s.split("-");switch(E){case"top":h=u.y-l,a=u.y-o;break;case"bottom":h=u.y+S-o-2*r+l,a=u.y+S+l-r}switch(C){case"left":w=u.x,x=u.x+i+r;break;case"right":w=u.x+O-i-2*r,x=u.x+O-r;break;default:w=u.x+(O-i)/2-2*r,x=u.x+(O+i)/2-r}e.fillRect(w,h,i+2*r,o+2*r),e.fillStyle=(null===(m=v.helperText)||void 0===m?void 0:m.textColor)||"white",e.fillText(t,x,a),e.setLineDash([])}},i=()=>{d(!1)},o=e=>{if(e.preventDefault(),0!==u.height&&0!==u.width){if("Enter"===e.key){const e={isCanceled:!1,capturedImage:g(),rectCoords:u};r&&r(e),d(!1)}"Escape"===e.key&&p()}};return l.addEventListener("mousedown",t),l.addEventListener("mousemove",n),l.addEventListener("mouseup",i),document.body.addEventListener("keydown",o,{passive:!1}),()=>{l.removeEventListener("mousedown",t),l.removeEventListener("mousemove",n),l.removeEventListener("mouseup",i),document.body.removeEventListener("keydown",o)}}),[l,a,u,v,g,r,p]),{canvasRef:o}},i=t.forwardRef(((n,i)=>{var{drawingEnabled:o=!1,containerDivClassName:l="",onCaptured:s,onCanceled:a}=n,d=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(n,["drawingEnabled","containerDivClassName","onCaptured","onCanceled"]);const c=t.useRef(null);return t.useImperativeHandle(i,(()=>c.current)),r(c,(e=>{const t=e.capturedImage;null==s||s(t),e.isCanceled&&(null==a||a())}),Object.assign(Object.assign({},d.option),{drawingEnabled:o})),e.jsx("div",{style:{position:"relative"},className:l,children:e.jsx("canvas",Object.assign({ref:c},d))})}));i.displayName="Canvas",exports.Canvas=i,exports.useCanvasSnap=r;
//# sourceMappingURL=index.js.map
