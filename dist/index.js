"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react/jsx-runtime"),t=require("react");function o(e,t,o,r){return new(o||(o=Promise))((function(n,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function l(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,l)}s((r=r.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const r=(e,t)=>{for(const o in t)if(t.hasOwnProperty(o)){const n=o;t[n]&&"object"==typeof t[n]&&!Array.isArray(t[n])?e[n]=r(e[n],t[n]):e[n]=t[n]}return e},n={drawingEnabled:!1,isGrayscale:!1,cursor:"crosshair",copyImageToClipBoard:!0,imageQuality:"high",rect:{outterBackgroundColor:"rgba(0, 0, 0, 0.1)",borderWidth:1,borderColor:"#F14236",borderStyle:"dashed"},helperText:{show:!0,backgroundColor:"#F14236",textColor:"#ffffff",position:"auto",fontSize:10,fontFamily:"Arial",padding:2,value:"Press Enter to capture, Escape to cancel",textHeight:10}},i={low:.1,medium:.5,high:1},a=(e,a,l=n)=>{const s=null!=e?e:t.useRef(null),[d,c]=t.useState(null),[u,h]=t.useState(!1),g=t.useMemo((()=>({width:0,height:0,x:0,y:0})),[]),[f,p]=t.useState(g),v=t.useMemo((()=>r(n,l)),[l]),y=t.useCallback((()=>{if(!d)return;const e=d.getContext("2d");null==e||e.clearRect(0,0,d.width,d.height),p(g)}),[d]);t.useEffect((()=>{var e,t;const o=s.current;if(o){if(p(g),[...(null===(e=o.parentElement)||void 0===e?void 0:e.children)||[]].forEach((e=>{var t;"CANVAS"===e.tagName&&e.classList.contains("drawer-layer")&&(null===(t=o.parentElement)||void 0===t||t.removeChild(e))})),!v.drawingEnabled)return;const r=o.cloneNode(!0);r.className="drawer-layer",r.removeAttribute("style"),r.style.position="absolute",r.style.cursor=v.cursor,r.style.inset="0",r.style.zIndex="10",r.style.background="transparent";const n=r.getContext("2d");n&&(n.clearRect(0,0,r.width,r.height),n.fillStyle=null===(t=v.rect)||void 0===t?void 0:t.outterBackgroundColor,n.fillRect(0,0,r.width,r.height)),c(r),o.after(r)}}),[s,v.drawingEnabled,g]);const b=t.useCallback((()=>{if(!f||!s.current)return null;const{x:e,y:t,width:o,height:r}=(e=>{let{x:t,y:o,width:r,height:n}=e;return r<0&&(t+=r,r=-r),n<0&&(o+=n,n=-n),{x:t,y:o,width:r,height:n}})(f),n=document.createElement("canvas");n.width=Math.abs(o),n.height=Math.abs(r);const a=n.getContext("2d");if(a){const{backgroundColor:i,background:l}=s.current.style;a.fillStyle=i||l||"#ffffff",a.fillRect(0,0,n.width,n.height),v.isGrayscale&&(a.filter="grayscale(100%)"),null==a||a.drawImage(s.current,e,t,Math.abs(o),Math.abs(r),0,0,Math.abs(o),Math.abs(r)),v.isGrayscale&&(a.filter="none")}return n.toDataURL("image/png",i[v.imageQuality])}),[f,s,v.isGrayscale]);return t.useEffect((()=>{if(!d)return;const e=d.getContext("2d");if(!e)return;if(!v.drawingEnabled)return void e.clearRect(0,0,d.width,d.height);const t=e=>{const t=d.getBoundingClientRect(),o=d.width/t.width,r=d.height/t.height,n=(e.clientX-t.left)*o,i=(e.clientY-t.top)*r;p((e=>Object.assign(Object.assign({},e),{x:n,y:i}))),h(!0)},r=t=>{var o,r,n,i,a,l,s,c,h,g,y,b,m,w;if(!u)return;const x=d.getBoundingClientRect(),{x:C,y:E}=f,S=d.width/x.width,k=d.height/x.height,O=(t.clientX-x.left)*S,j=(t.clientY-x.top)*k,R=O-C,T=j-E;p((e=>Object.assign(Object.assign({},e),{width:R,height:T}))),e.clearRect(0,0,d.width,d.height),e.fillStyle=null===(o=v.rect)||void 0===o?void 0:o.outterBackgroundColor,e.fillRect(0,0,d.width,d.height);const L=null===(r=v.rect)||void 0===r?void 0:r.borderWidth;if(e.clearRect(C,E,R,T),"dashed"===(null===(n=v.rect)||void 0===n?void 0:n.borderStyle)?e.setLineDash([2*L,L]):"dotted"===(null===(i=v.rect)||void 0===i?void 0:i.borderStyle)?e.setLineDash([L,L]):e.setLineDash([]),e.strokeStyle=null===(a=v.rect)||void 0===a?void 0:a.borderColor,e.lineWidth=L,e.strokeRect(C-L/2,E-L/2,R+L,T+L),!v.helperText||v.helperText.show){if(!(null===(l=v.helperText)||void 0===l?void 0:l.show))return;const t=null===(s=v.helperText)||void 0===s?void 0:s.value;e.font=`${null===(c=v.helperText)||void 0===c?void 0:c.fontSize}px ${null===(h=v.helperText)||void 0===h?void 0:h.fontFamily}`,e.textBaseline="bottom",e.textAlign="right";const o=e.measureText(t),r=null===(g=v.helperText)||void 0===g?void 0:g.padding,n=o.width,i=null===(y=v.helperText)||void 0===y?void 0:y.fontSize,a=2*i+r;e.fillStyle=null===(b=v.helperText)||void 0===b?void 0:b.backgroundColor;let d=null===(m=v.helperText)||void 0===m?void 0:m.position;if("auto"===d){let e="top",t="right";E<a&&(e="bottom"),E+T>=x.height-a&&(e="top"),T<0&&(e="top",T+E<=a&&(e="bottom")),n<=x.width&&R>0?(t="left",C+n>=x.width&&(t="right")):(t="right",C+R<n&&(t="left")),d=`${e}-${t}`}let u=0,f=0,p=0,S=0;const[k,O]=d.split("-");switch(k){case"top":T<0?(f=E-a+T,u=E-i+T):(f=E-a,u=E-i);break;case"bottom":T<0?(f=E-i-2*r+a,u=E+a-r):(f=E+T-i-2*r+a,u=E+T+a-r)}switch(O){case"left":R<0?(S=C+R,p=C+R+n+r):(S=C,p=C+n+r);break;case"right":R<0?(S=C-n-2*r,p=C-r):(S=C+R-n-2*r,p=C+R-r);break;default:S=C+(R-n)/2-2*r,p=C+(R+n)/2-r}e.fillRect(S,f,n+2*r,i+2*r),e.fillStyle=null===(w=v.helperText)||void 0===w?void 0:w.textColor,e.fillText(t,p,u),e.setLineDash([])}},n=()=>{h(!1)},i=e=>o(void 0,void 0,void 0,(function*(){if(e.preventDefault(),"Enter"===e.key){if(0===f.height||0===f.width)return;const e={isCanceled:!1,capturedImage:b(),rectCoords:f};null==a||a(e),v.copyImageToClipBoard&&(yield((e,t="image/png")=>o(void 0,void 0,void 0,(function*(){try{const o=e.replace(/^data:.+;base64,/,""),r=atob(o),n=new Array(r.length);for(let e=0;e<r.length;e++)n[e]=r.charCodeAt(e);const i=new Uint8Array(n),a=new Blob([i],{type:t}),l=new ClipboardItem({[t]:a});yield navigator.clipboard.write([l]),console.log("Base64 image copied to clipboard!")}catch(e){console.error("Failed to copy Base64 image to clipboard:",e)}})))(e.capturedImage)),h(!1)}if("Escape"===e.key){y();null==a||a({isCanceled:!0,capturedImage:null,rectCoords:null})}}));return d.addEventListener("mousedown",t),d.addEventListener("mousemove",r),d.addEventListener("mouseup",n),document.body.addEventListener("keydown",i,{passive:!1}),()=>{d.removeEventListener("mousedown",t),d.removeEventListener("mousemove",r),d.removeEventListener("mouseup",n),document.body.removeEventListener("keydown",i)}}),[d,u,f,v,b,a,y]),{canvasRef:s}},l=t.forwardRef(((o,r)=>{var{drawingEnabled:n=!1,containerDivClassName:i="",onImageCaptured:l,onCaptureCanceled:s,option:d}=o,c=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(o[r[n]]=e[r[n]])}return o}(o,["drawingEnabled","containerDivClassName","onImageCaptured","onCaptureCanceled","option"]);const u=t.useRef(null),h=t.useMemo((()=>!!n),[n]);return t.useImperativeHandle(r,(()=>u.current)),a(u,(e=>{const{isCanceled:t,capturedImage:o,rectCoords:r}=e;if(o&&r){const e=o,{width:t,height:n}=r;null==l||l({src:e,width:t,height:n,coordinates:r})}t&&(null==s||s())}),Object.assign(Object.assign({},d),{drawingEnabled:h})),e.jsx("div",Object.assign({style:{position:"relative"},className:i},{children:e.jsx("canvas",Object.assign({className:"react-canvas-snap_canvas",ref:u},c))}))}));l.displayName="Canvas",exports.Canvas=l,exports.useCanvasSnap=a;
//# sourceMappingURL=index.js.map
